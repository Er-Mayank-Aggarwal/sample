<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Baloo 2';
            margin: 0;
            padding: 0;
            background: #fff;
            color: #474747;
            padding-bottom: 20px;
        }

        /* IMAGE CAROUSEL SECTION */
        .image-section {
            position: relative;
            width: 100%;
            height: 300px;
            background: #fff;
            margin-bottom: 20px;
            overflow: hidden; /* Hide scrollbars outside */
        }

        /* The Scrolling Track */
        .carousel-track {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            height: 100%;
            width: 100%;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        .carousel-track::-webkit-scrollbar { display: none; /* Hide scrollbar Chrome/Safari */ }

        /* Individual Image Wrapper */
        .carousel-item {
            flex: 0 0 100%; /* Takes full width */
            scroll-snap-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .main-img {
            max-height: 250px;
            max-width: 80%;
            object-fit: contain;
        }

        /* GREEN SIDE BADGE */
        .side-badge {
            position: absolute;
            top: 0; right: 0;
            background: #8BC34A; /* Listerr Green */
            color: white;
            width: 40px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: 700;
            font-size: 16px;
            letter-spacing: 1px;
            border-bottom-left-radius: 5px;
            box-shadow: -2px 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .side-badge i { margin-bottom: 8px; transform: rotate(90deg); }

        /* DOTS */
        .dots {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex; gap: 6px;
            z-index: 10;
        }
        .dot { 
            width: 8px; height: 8px; 
            background: #e0e0e0; 
            border-radius: 50%; 
            transition: background 0.3s;
        }
        .dot.active { background: #555; }

        /* CONTENT */
        .content { padding: 0 20px; }

        .title-row {
            display: flex; justify-content: space-between; align-items: flex-start;
        }
        
        .p-title { font-size: 20px; font-weight: 700; line-height: 1.2; width: 85%; }
        
        .share-btn { 
            color: #555; 
            font-size: 20px; 
            cursor: pointer; 
            padding: 5px;
        }
        .share-btn:active { transform: scale(0.9); }

        .p-volume { font-size: 14px; color: #888; margin-top: 4px; margin-bottom: 16px; }

        /* PRICE & ADD ROW */
        .action-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .price-block { display: flex; flex-direction: column; }
        .price-label { font-size: 14px; font-weight: 600; color: #333; }
        .current-p { font-size: 18px; font-weight: 700; color: #333; }
        .mrp { font-size: 12px; color: #999; text-decoration: line-through; }

        .add-btn-lg {
            background: #4280FD;
            color: white;
            border: none;
            padding: 10px 40px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(66, 128, 253, 0.3);
        }

        /* QTY CONTROL (Same as Menu) */
        .qty-control-lg {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            border: 2px solid #4280FD;
            border-radius: 8px;
            padding: 8px 20px;
            background: #fff;
        }

        .qty-btn-lg {
            background: none;
            border: none;
            color: #4280FD;
            font-size: 22px;
            font-weight: 700;
            cursor: pointer;
            padding: 0 8px;
        }

        .qty-btn-lg:active {
            transform: scale(0.9);
        }

        .qty-value-lg {
            font-size: 18px;
            font-weight: 700;
            min-width: 24px;
            text-align: center;
            color: #333;
        }

        .sold-by {
            font-size: 13px; color: #666;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #eee;
        }
        .sold-link { color: #4280FD; font-weight: 600; text-decoration: none; }

        /* INFO TABLE */
        .section-title { font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #555; }

        .info-table { width: 100%; border-collapse: collapse; }
        .info-table td {
            padding: 8px 0;
            font-size: 14px;
            border-bottom: 1px solid #f9f9f9;
        }
        .info-label { color: #888; width: 40%; }
        .info-val { color: #333; font-weight: 500; text-align: right; }

        .disclaimer {
            margin-top: 30px;
            font-size: 11px;
            color: #aaa;
            line-height: 1.4;
        }
    </style>
</head>
<body>

    <div class="image-section">
        <div class="side-badge">
             <span>Listerr</span> 
             <i class="fas fa-leaf" style="margin-bottom:10px; transform: rotate(0deg);"></i>
        </div>
        
        <div class="carousel-track" id="track">
            </div>
        
        <div class="dots" id="dots-container">
            <div class="dot active"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>

    <div class="content">
        <div class="title-row">
            <div class="p-title" id="p-name">Loading...</div>
            <i class="fas fa-share-alt share-btn" onclick="shareProduct()"></i>
        </div>
        <div class="p-volume">1 Unit</div>

        <div class="action-row">
            <div class="price-block">
                <span class="price-label">Listerr Price: <span id="p-price">₹0</span></span>
                <span class="mrp">MRP: <span id="p-mrp">₹0</span></span>
            </div>
            <div id="add-control-container">
                <button class="add-btn-lg" onclick="addToCartFromPage()">ADD</button>
            </div>
        </div>

        <div class="sold-by">
            Sold by <a href="#" class="sold-link">JARS N' MORE</a>
        </div>

        <div class="section-title">More Information</div>
        <table class="info-table">
            <tr>
                <td class="info-label">Shelf Life</td>
                <td class="info-val">3 Days</td>
            </tr>
            <tr>
                <td class="info-label">Unit</td>
                <td class="info-val">Piece (Pc)</td>
            </tr>
            <tr>
                <td class="info-label">Brand</td>
                <td class="info-val">Jars n' More</td>
            </tr>
            <tr>
                <td class="info-label">Type</td>
                <td class="info-val">Fresh Bakery</td>
            </tr>
        </table>

        <div class="disclaimer">
            Product images shown are for representative purposes only. 
            Actual products may vary. Please read product labels carefully before consuming.
        </div>
    </div>

    <script>
        // 1. Load Data on Startup
        const product = JSON.parse(localStorage.getItem('selectedProduct'));
        let cart = JSON.parse(localStorage.getItem('cart')) || {};

        // 2. Populate Page with Data
        if(product) {
            document.getElementById('p-name').textContent = product.name;
            document.getElementById('p-price').textContent = '₹' + product.price;
            // Calculate a fake MRP (20% higher) for display
            document.getElementById('p-mrp').textContent = '₹' + (product.price * 1.2).toFixed(2);
            
            // SETUP CAROUSEL (Injecting the same image 3 times for demo)
            const track = document.getElementById('track');
            const imgUrl = product.image || 'fallback.jpeg'; // Fallback if image is missing
            
            track.innerHTML = `
                <div class="carousel-item"><img src="${imgUrl}" class="main-img"></div>
                <div class="carousel-item"><img src="${imgUrl}" class="main-img" style="filter: hue-rotate(15deg);"></div>
                <div class="carousel-item"><img src="${imgUrl}" class="main-img" style="filter: hue-rotate(-15deg);"></div>
            `;
        } else {
            console.error("No product data found in LocalStorage");
        }

        /* ================================
           CAROUSEL SCROLL LOGIC
        ================================ */
        const track = document.getElementById('track');
        const dots = document.querySelectorAll('.dot');
        
        if(track) {
            track.addEventListener('scroll', () => {
                const width = track.offsetWidth;
                const scrollPos = track.scrollLeft;
                const index = Math.round(scrollPos / width);
                
                dots.forEach(d => d.classList.remove('active'));
                if(dots[index]) dots[index].classList.add('active');
            });
        }

        /* ================================
           SHARE FUNCTION
        ================================ */
        async function shareProduct() {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: product ? product.name : 'Jars n More',
                        text: 'Check out this item from Jars n More!',
                        url: window.location.href
                    });
                } catch (err) { console.log('Share canceled', err); }
            } else {
                alert('Link copied to clipboard!');
            }
        }

        /* ================================
           UPDATE PARENT BADGE
        ================================ */
        function updateBadges() {
            const newCount = Object.values(cart).reduce((sum, item) => sum + item.qty, 0);
            
            // Update Parent Badge (Index.html)
            try { 
                window.parent.document.querySelector('.cart-badge').textContent = newCount; 
            } catch(e) { 
                console.log("Could not update parent badge"); 
            }
        }

        /* ================================
           RENDER ADD/QTY CONTROL
        ================================ */
        function renderAddControl() {
            const container = document.getElementById('add-control-container');
            
            if (!product) return;
            
            // Refresh cart from storage
            cart = JSON.parse(localStorage.getItem('cart')) || {};
            
            if (cart[product.name] && cart[product.name].qty > 0) {
                // Show QTY Control
                container.innerHTML = `
                    <div class="qty-control-lg">
                        <button class="qty-btn-lg" onclick="decreaseQty()">−</button>
                        <span class="qty-value-lg">${cart[product.name].qty}</span>
                        <button class="qty-btn-lg" onclick="increaseQty()">+</button>
                    </div>
                `;
            } else {
                // Show ADD Button
                container.innerHTML = `
                    <button class="add-btn-lg" onclick="addToCartFromPage()">ADD</button>
                `;
            }
        }

        /* ================================
           ADD TO CART
        ================================ */
        function addToCartFromPage() {
            if(!product) {
                alert("Error: Product data not loaded. Please go back to the menu.");
                return;
            }
            
            // Refresh Cart
            cart = JSON.parse(localStorage.getItem('cart')) || {};

            // Add item with qty 1
            cart[product.name] = { 
                price: product.price, 
                qty: 1, 
                img: product.image 
            };
            
            // Save to Storage
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Update UI
            renderAddControl();
            updateBadges();
        }

        /* ================================
           INCREASE QTY
        ================================ */
        function increaseQty() {
            if(!product) return;
            
            cart = JSON.parse(localStorage.getItem('cart')) || {};
            
            if (cart[product.name]) {
                cart[product.name].qty++;
                localStorage.setItem('cart', JSON.stringify(cart));
                renderAddControl();
                updateBadges();
            }
        }

        /* ================================
           DECREASE QTY
        ================================ */
        function decreaseQty() {
            if(!product) return;
            
            cart = JSON.parse(localStorage.getItem('cart')) || {};
            
            if (cart[product.name]) {
                cart[product.name].qty--;
                
                if (cart[product.name].qty <= 0) {
                    delete cart[product.name];
                }
                
                localStorage.setItem('cart', JSON.stringify(cart));
                renderAddControl();
                updateBadges();
            }
        }

        /* ================================
           INIT - Render correct state
        ================================ */
        renderAddControl();
        updateBadges();
    </script>
</body>
</html>